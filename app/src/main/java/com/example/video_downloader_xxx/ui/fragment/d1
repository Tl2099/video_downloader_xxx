# ğŸ¯ HÆ¯á»šNG DáºªN Táº O APP Táº¢I VIDEO Tá»ª WEB

## ğŸ“‹ Tá»”NG QUAN KIáº¾N TRÃšC

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UI LAYER                           â”‚
â”‚  (BrowserFragment, ProgressFragment, MainActivity)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIEWMODEL LAYER                      â”‚
â”‚  (BrowserViewModel, ProgressViewModel, MainViewModel)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  REPOSITORY LAYER                       â”‚
â”‚         (VideoRepository, ConfigRepository)             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                     â”‚
       â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LOCAL DATA  â”‚                     â”‚ REMOTE DATA  â”‚
â”‚   (Room)    â”‚                     â”‚   (Retrofit) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ BÆ¯á»šC 1: Táº O PROJECT VÃ€ DEPENDENCIES

### 1.1. Táº¡o Android Project
- Má»Ÿ Android Studio
- Táº¡o New Project vá»›i **Empty Activity**
- Chá»n language: **Kotlin**
- Minimum SDK: **21 (Android 5.0)**

### 1.2. Cáº¥u hÃ¬nh `build.gradle` (Project level)

```gradle
buildscript {
    ext.kotlin_version = "1.3.11"
    repositories {
        google()
        jcenter()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.4.0'
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "org.jetbrains.kotlin:kotlin-allopen:$kotlin_version"
    }
}
```

### 1.3. Cáº¥u hÃ¬nh `build.gradle` (Module: app)

```gradle
apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'
apply plugin: 'kotlin-kapt'
apply plugin: 'kotlin-allopen'

android {
    compileSdkVersion 28

    defaultConfig {
        applicationId "com.yourname.videodownloader"
        minSdkVersion 21
        targetSdkVersion 28
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    dataBinding {
        enabled = true
    }
}

dependencies {
    // Android Support
    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'com.android.support:design:28.0.0'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'

    // Kotlin
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"

    // ViewModel & LiveData
    implementation 'android.arch.lifecycle:extensions:1.1.1'
    kapt 'android.arch.lifecycle:compiler:1.1.1'

    // Room
    implementation 'android.arch.persistence.room:runtime:1.1.1'
    implementation 'android.arch.persistence.room:rxjava2:1.1.1'
    kapt 'android.arch.persistence.room:compiler:1.1.1'

    // Dagger 2 (Dependency Injection)
    implementation 'com.google.dagger:dagger:2.19'
    implementation 'com.google.dagger:dagger-android:2.19'
    implementation 'com.google.dagger:dagger-android-support:2.19'
    kapt 'com.google.dagger:dagger-compiler:2.19'
    kapt 'com.google.dagger:dagger-android-processor:2.19'

    // Network
    implementation 'com.squareup.retrofit2:retrofit:2.3.0'
    implementation 'com.squareup.retrofit2:adapter-rxjava2:2.3.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.3.0'
    implementation 'com.squareup.okhttp3:okhttp:3.11.0'
    implementation 'com.squareup.okhttp3:logging-interceptor:3.11.0'

    // RxJava
    implementation 'io.reactivex.rxjava2:rxjava:2.2.2'
    implementation 'io.reactivex.rxjava2:rxandroid:2.1.0'

    // Glide (Load images)
    implementation 'com.github.bumptech.glide:glide:4.8.0'
    annotationProcessor 'com.github.bumptech.glide:compiler:4.8.0'

    // Testing
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}

// For @OpenForTesting annotation
allOpen {
    annotation 'com.yourname.videodownloader.OpenForTesting'
}
```

### 1.4. ThÃªm permissions vÃ o `AndroidManifest.xml`

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- Required for download -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

    <application
        android:name=".DLApplication"
        ...>
    </application>
</manifest>
```

---

## ğŸ—ï¸ BÆ¯á»šC 2: Táº O Cáº¤U TRÃšC THÆ¯ Má»¤C

```
app/src/main/java/com/yourname/videodownloader/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”œâ”€â”€ VideoInfo.kt
â”‚   â”‚   â”‚   â”œâ”€â”€ ProgressInfo.kt
â”‚   â”‚   â”‚   â””â”€â”€ SupportedPage.kt
â”‚   â”‚   â””â”€â”€ VideoLocalDataSource.kt
â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â””â”€â”€ VideoService.kt
â”‚   â”‚   â””â”€â”€ VideoRemoteDataSource.kt
â”‚   â””â”€â”€ repository/
â”‚       â””â”€â”€ VideoRepository.kt
â”œâ”€â”€ di/
â”‚   â”œâ”€â”€ component/
â”‚   â”‚   â””â”€â”€ AppComponent.kt
â”‚   â””â”€â”€ module/
â”‚       â”œâ”€â”€ AppModule.kt
â”‚       â”œâ”€â”€ NetworkModule.kt
â”‚       â”œâ”€â”€ RepositoryModule.kt
â”‚       â””â”€â”€ ViewModelModule.kt
â”œâ”€â”€ util/
â”‚   â”œâ”€â”€ SingleLiveEvent.kt
â”‚   â”œâ”€â”€ scheduler/
â”‚   â”‚   â””â”€â”€ BaseSchedulers.kt
â”‚   â””â”€â”€ ViewModelFactory.kt
â””â”€â”€ ui/
    â”œâ”€â”€ main/
    â”‚   â”œâ”€â”€ base/
    â”‚   â”‚   â”œâ”€â”€ BaseActivity.kt
    â”‚   â”‚   â”œâ”€â”€ BaseFragment.kt
    â”‚   â”‚   â””â”€â”€ BaseViewModel.kt
    â”‚   â”œâ”€â”€ home/
    â”‚   â”‚   â”œâ”€â”€ MainActivity.kt
    â”‚   â”‚   â”œâ”€â”€ MainViewModel.kt
    â”‚   â”‚   â”œâ”€â”€ BrowserFragment.kt
    â”‚   â”‚   â””â”€â”€ BrowserViewModel.kt
    â”‚   â””â”€â”€ progress/
    â”‚       â”œâ”€â”€ ProgressFragment.kt
    â”‚       â””â”€â”€ ProgressViewModel.kt
    â””â”€â”€ component/
        â”œâ”€â”€ adapter/
        â””â”€â”€ dialog/
```

---

## ğŸ“ BÆ¯á»šC 3: Táº O CÃC FILE CHÃNH

### 3.1. Application Class

**File: `DLApplication.kt`**
```kotlin
package com.yourname.videodownloader

import android.app.Application

class DLApplication : Application() {
    override fun onCreate() {
        super.onCreate()
    }
}
```

### 3.2. Data Model - VideoInfo

**File: `data/local/model/VideoInfo.kt`**
```kotlin
package com.yourname.videodownloader.data.local.model

import android.arch.persistence.room.ColumnInfo
import android.arch.persistence.room.Entity
import android.arch.persistence.room.PrimaryKey
import com.google.gson.annotations.Expose
import com.google.gson.annotations.SerializedName
import java.util.*

@Entity(tableName = "VideoInfo")
data class VideoInfo(
    @PrimaryKey
    @ColumnInfo(name = "id")
    var id: String = UUID.randomUUID().toString(),

    @ColumnInfo(name = "downloadUrl")
    @SerializedName("url")
    @Expose
    var downloadUrl: String = "",

    @ColumnInfo(name = "title")
    @SerializedName("title")
    @Expose
    var title: String = "",

    @ColumnInfo(name = "ext")
    @SerializedName("ext")
    @Expose
    var ext: String = "",

    @ColumnInfo(name = "thumbnail")
    @SerializedName("thumbnail")
    @Expose
    var thumbnail: String = "",

    @ColumnInfo(name = "duration")
    @SerializedName("duration")
    @Expose
    var duration: Int = 0,

    @ColumnInfo(name = "originalUrl")
    var originalUrl: String = ""
) {
    val name
        get() = "$title.$ext"
}
```

### 3.3. Repository Pattern

**File: `data/repository/VideoRepository.kt`**
```kotlin
package com.yourname.videodownloader.data.repository

import com.yourname.videodownloader.data.local.model.VideoInfo
import io.reactivex.Flowable

interface VideoRepository {
    fun getVideoInfo(url: String): Flowable<VideoInfo>
    fun saveVideoInfo(videoInfo: VideoInfo)
}

class VideoRepositoryImpl(
    private val remoteDataSource: VideoRepository
) : VideoRepository {

    override fun getVideoInfo(url: String): Flowable<VideoInfo> {
        return remoteDataSource.getVideoInfo(url)
    }

    override fun saveVideoInfo(videoInfo: VideoInfo) {
        remoteDataSource.saveVideoInfo(videoInfo)
    }
}
```

### 3.4. Network Service

**File: `data/remote/service/VideoService.kt`**
```kotlin
package com.yourname.videodownloader.data.remote.service

import com.yourname.videodownloader.data.local.model.VideoInfo
import io.reactivex.Flowable
import retrofit2.http.GET
import retrofit2.http.Query

interface VideoService {
    @GET("info")
    fun getVideoInfo(@Query("url") url: String): Flowable<VideoInfo>
}
```

### 3.5. Remote Data Source

**File: `data/remote/VideoRemoteDataSource.kt`**
```kotlin
package com.yourname.videodownloader.data.remote

import com.yourname.videodownloader.data.local.model.VideoInfo
import com.yourname.videodownloader.data.remote.service.VideoService
import io.reactivex.Flowable

class VideoRemoteDataSource(
    private val videoService: VideoService
) {

    fun getVideoInfo(url: String): Flowable<VideoInfo> {
        return videoService.getVideoInfo(url)
    }
}
```

---

## ğŸ¨ BÆ¯á»šC 4: Táº O UI - BROWSER

### 4.1. Layout `fragment_browser.xml`

```xml
<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">

    <data>
        <variable name="viewModel" type="com.yourname.videodownloader.ui.main.home.BrowserViewModel"/>
    </data>

    <android.support.design.widget.CoordinatorLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <WebView
            android:id="@+id/webview"
            android:layout_width="match_parent"
            android:layout_height="match_parent" />

        <android.support.design.widget.FloatingActionButton
            android:id="@+id/fab_download"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="bottom|end"
            android:layout_margin="16dp"
            android:src="@android:drawable/ic_menu_upload"
            android:onClick="@{() -> viewModel.getVideoInfo()}"
            android:visibility="@{viewModel.isShowFabBtn ? View.VISIBLE : View.GONE}"/>
    </android.support.design.widget.CoordinatorLayout>
</layout>
```

### 4.2. BrowserViewModel

**File: `ui/main/home/BrowserViewModel.kt`**
```kotlin
package com.yourname.videodownloader.ui.main.home

import android.databinding.ObservableBoolean
import android.databinding.ObservableField
import com.yourname.videodownloader.data.local.model.VideoInfo
import com.yourname.videodownloader.data.repository.VideoRepository
import com.yourname.videodownloader.ui.main.base.BaseViewModel
import com.yourname.videodownloader.util.SingleLiveEvent
import io.reactivex.disposables.CompositeDisposable

class BrowserViewModel(
    private val videoRepository: VideoRepository
) : BaseViewModel() {

    val textInput = ObservableField<String>("")
    val pageUrl = ObservableField<String>("")
    val isShowFabBtn = ObservableBoolean(false)
    val isLoadingVideoInfo = ObservableBoolean(false)

    val showDownloadDialogEvent = SingleLiveEvent<VideoInfo>()

    private lateinit var compositeDisposable: CompositeDisposable

    override fun start() {
        compositeDisposable = CompositeDisposable()
    }

    override fun stop() {
        compositeDisposable.clear()
    }

    fun getVideoInfo() {
        textInput.get()?.let { url ->
            videoRepository.getVideoInfo(url)
                .doOnSubscribe { isLoadingVideoInfo.set(true) }
                .doAfterTerminate { isLoadingVideoInfo.set(false) }
                .subscribeOn(io())
                .observeOn(mainThread())
                .subscribe({ videoInfo ->
                    showDownloadDialogEvent.value = videoInfo
                }, { error ->
                    error.printStackTrace()
                })
                .let { compositeDisposable.add(it) }
        }
    }
}
```

---

## ğŸ“¥ BÆ¯á»šC 5: Táº O UI - PROGRESS & DOWNLOAD

### 5.1. ProgressViewModel

**File: `ui/main/progress/ProgressViewModel.kt`**
```kotlin
package com.yourname.videodownloader.ui.main.progress

import android.app.DownloadManager
import android.app.DownloadManager.Request
import android.databinding.ObservableArrayList
import android.databinding.ObservableList
import android.net.Uri
import com.yourname.videodownloader.data.local.model.VideoInfo
import com.yourname.videodownloader.ui.main.base.BaseViewModel
import io.reactivex.Completable
import io.reactivex.disposables.CompositeDisposable
import java.io.File

class ProgressViewModel(
    private val downloadManager: DownloadManager,
    private val folderDir: File
) : BaseViewModel() {

    val progressInfos: ObservableList<ProgressInfo> = ObservableArrayList()

    private lateinit var compositeDisposable: CompositeDisposable

    override fun start() {
        compositeDisposable = CompositeDisposable()
    }

    override fun stop() {
        compositeDisposable.clear()
    }

    fun downloadVideo(videoInfo: VideoInfo?) {
        videoInfo?.let {
            if (!folderDir.exists() && !folderDir.mkdirs()) return

            val request = Request(Uri.parse(it.downloadUrl)).apply {
                setDestinationInExternalPublicDir("VideoDownloader", it.name)
                setNotificationVisibility(Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED)
                allowScanningByMediaScanner()
            }

            val downloadId = downloadManager.enqueue(request)
            // Save to local database...
        }
    }
}
```

---

## ğŸ”Œ BÆ¯á»šC 6: SETUP BACKEND API

### Báº¡n cÃ³ 2 lá»±a chá»n:

#### CÃ¡ch 1: Sá»­ dá»¥ng backend cÃ³ sáºµn
```
API: http://youtube-dl-android.herokuapp.com/api/info
Query: ?url=VIDEO_URL
```

#### CÃ¡ch 2: Táº¡o backend riÃªng vá»›i Node.js + youtube-dl

**File: `server.js`**
```javascript
const express = require('express');
const youtubeDl = require('youtube-dl');
const app = express();

app.get('/api/info', (req, res) => {
    const url = req.query.url;

    youtubeDl.getInfo(url, ['--format=best'], (err, info) => {
        if (err) {
            return res.status(400).json({ error: err.message });
        }

        res.json({
            downloadUrl: info.url,
            title: info.title,
            ext: info.ext,
            thumbnail: info.thumbnail,
            duration: info.duration
        });
    });
});

app.listen(3000, () => {
    console.log('Server running on port 3000');
});
```

**Deploy lÃªn Heroku:**
```bash
# Táº¡o file package.json
npm init -y
npm install express youtube-dl
npm install -g heroku

# Deploy
git init
git add .
git commit -m "Initial commit"
heroku create
git push heroku master
```

---

## ğŸš€ BÆ¯á»šC 7: TRIá»‚N KHAI DOWNLOAD

### 7.1. MainActivity

**File: `ui/main/home/MainActivity.kt`**
```kotlin
package com.yourname.videodownloader.ui.main.home

import android.Manifest
import android.content.pm.PackageManager
import android.support.v4.app.ActivityCompat
import android.support.v4.content.ContextCompat
import android.support.v4.view.ViewPager
import android.support.v7.app.AppCompatActivity
import android.os.Bundle
import kotlinx.android.synthetic.main.activity_main.*

class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        grantPermissions()

        val adapter = PagerAdapter(supportFragmentManager)
        viewPager.adapter = adapter
    }

    private fun grantPermissions() {
        if (ContextCompat.checkSelfPermission(
                this, Manifest.permission.WRITE_EXTERNAL_STORAGE
            ) != PackageManager.PERMISSION_GRANTED
        ) {
            ActivityCompat.requestPermissions(
                this,
                arrayOf(Manifest.permission.WRITE_EXTERNAL_STORAGE),
                0
            )
        }
    }
}
```

---

## ğŸ“ TÃ“M Táº®T CHECKLIST

- [ ] Setup project Android vá»›i Kotlin
- [ ] ThÃªm dependencies vÃ o build.gradle
- [ ] Táº¡o cáº¥u trÃºc thÆ° má»¥c theo Architecture Component
- [ ] Implement Data layer (VideoInfo, Repository)
- [ ] Implement Remote layer (Retrofit + VideoService)
- [ ] Setup Backend API (youtube-dl server)
- [ ] Implement UI layer (BrowserFragment + ProgressFragment)
- [ ] Implement ViewModel layer
- [ ] Implement DownloadManager
- [ ] Test app vá»›i cÃ¡c trang web khÃ¡c nhau

---

## ğŸ“ NEXT STEPS

1. **Test vá»›i nhiá»u nguá»“n video**: YouTube, Facebook, TikTok, etc.
2. **Tá»‘i Æ°u UI/UX**: Progress bar, notification
3. **ThÃªm features**: Playlist download, cháº¥t lÆ°á»£ng video
4. **Error handling**: Xá»­ lÃ½ lá»—i máº¡ng, file corruption
5. **Performance**: Caching, background download

---

## ğŸ“ SUPPORT

Náº¿u cÃ³ váº¥n Ä‘á», hÃ£y check:
- Logcat Ä‘á»ƒ debug
- Network traffic vá»›i Stetho
- Database vá»›i Room Inspector
- API response vá»›i Postman

Good luck! ğŸš€

